regex_definitions:
  # Regular expression to match zip prefix
  kZipPrefixValueRe:
    regex_fragment: (?:[ABCEGHJ-NPRSTVXY]\d[ABCEGHJ-NPRSTV-Z])

  # Regular expression to match zip suffix
  kZipSuffixValueRe:
    regex_fragment: (?:\d[ABCEGHJ-NPRSTV-Z]\d)

capture_definitions:
  ParsePostalCodeExpression:
    capture:
      output: postal-code
      parts:
      - capture:
          output: postal-code-prefix
          parts: [ {regex_reference: kZipPrefixValueRe} ]
      - no_capture:
          parts:
          - separator: {regex_reference: kWhitespaceSeparator}
          quantifier: MATCH_OPTIONAL
      - capture:
          output: postal-code-suffix
          parts: [ {regex_reference: kZipSuffixValueRe} ]
          quantifier: MATCH_OPTIONAL

parsing_definitions:
  postal-code:
    decomposition:
      capture_reference: ParsePostalCodeExpression

test_parsing_definitions:
- id: "zip code"
  type: postal-code
  input: "K1A 0B1"
  output:
    postal-code-prefix: "K1A"
    postal-code-suffix: "0B1"
- id: "zip code without separator"
  type: postal-code
  input: "K1A0B1"
  output:
    postal-code-prefix: "K1A"
    postal-code-suffix: "0B1"
